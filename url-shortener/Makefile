
## local stuff

clean: 
	find . -name 'url-shortener' -type f -exec rm -f {} \; 
	go clean

setup:
	go mod init src/top_domains

build:
	go build -o bin/url-shortener src/

mongodb-run:
	docker run --name mongodb -p 27017:27017 -d mongo:3.7

run: build
	bin/url-shortener


## local test stuff
test-ping:
	curl localhost:8080/

test-shorten:
	curl -i -X POST \
  	http://localhost:8080/shorten \
  	-H 'Content-Type: application/json' \
	-d '{ "url": "https://www.google.com", "Username" : "test1" }' 
	curl -i -X POST \
  	http://localhost:8080/shorten \
  	-H 'Content-Type: application/json' \
	-d '{ "url": ""https://longurlmaker.com/go?id=KEMQORCWMKXIBPGFZNXDCRHZWYWYSCZDHMTVDWRQGPZIEFOESLHVDOVAMSYFUYIBKCWOYOEFDDNIIBMBNTXQISQVKPAFNJGYMDMLSQQWUEEDGRETLCKTUAOFQPKDZRBMVNXNEOKYSOBYGGRRIBLDCAJSQUWPLYBHMZVQNFPFUREAXWSGYEKAETTUNQKZOLHBLCRYIHECYIDWEWDDANEEHYZUOJUDVBEGEWEMDJPCRTZWQCAQPEVWCURQELTZNYGRULEXUUAMNZIDBIURNQOPLFGPRZPFXVXSGCQAWQMKQVOREIJRYXGJDMZVMOAKJXCQZTQWJDGZYURCDBUCYAMCNLXAZYKJWNZWGQSQTZQSUHUXIOZHPLKCXHDWGNGCBFYHWRYPQOHKVCIERIMGUWJREMOLAUNBAMJWDHMUWUFRWNWNWJUQGEIKRWVSRJUSVEOZMBTIVZZRMWFJFAZLFHWWESOVCJNXNCXZDRHYQHQDDWMJWLVBTSYXKNTNWHKJJIJNZQMPXDSBZELWQGXJYWHJJAWGIHQSPZFPPSEMVWOUBZQRGOAEKIOUJLARTQJJPPYFIDSDZGYBFPSLETQOBFJLRKCLBMVQBTWKWONWUMXABQMFJDULJDWAOZMPLHGNACXXQLULXSLYIYESBYEKCBLQAXFMEMAFOXDFJXQGQCFZAJSBIWMKYXAZUGLZSLEHJIMTFCZWFFVFONHWKUHIRIHMPTMHFRPOZBIFEHBKNWPBKXYURGDJOKWDEJLJABYZCGEHNFRBCHDMFCGWIJGXUDAYMMHMNFMQLQYZWPAYXELCGSZOCGLWJMVWYDIMJVDVLBVIRWHOASRGKQUMXGJGSEDRHMEQHHMTIHBADIPDBGJLXEXUKHBCLETTRXKYFWRNDTOGBDKCKTOIXMDHTFKFJDYBBJZGFRUJKJQLNAOXTCFRPJZIOJNYNMZPVYWAPQJZAALNAAKTDQLSAKAOTOMHALWVKSWAJGAJGMWHMHAPYMIYWJMQXZYYKUUVMQVWXWFEICLUJMKIYSGVBTMZSKXDFRYRIUNGQTLYVWTFJDNIWUEYNQXGBVJGMIYVCMBTFMRBJLGSPTBLNFKAWHHXCQEPZCKCPMVUZNVJYCBNVDZJIJKERRBUIGJHIUJYHESGSOPRRREMUEVDOFHFXJZFPJMYDVWKAPRTEHKVYPITTDWIJDOGNOLCXYBBUYMUNENSLYNJNWDHAZPJDDQQRCTPAVRUTDPHHDZSBNCPJGWJFMTJPKAHNUXNPOIIRYPZCPSECUTMAQVGCPPSAQZNKXAZLJICIXCKMUPPPIBPZXWBMMUMCUZNRAMCKUFTSHDFCTURCVGBSDDFPXRSRRFIRSKCNPVFXZKZSFQUAXVTBYYQWPJNHPVZHFBUVXATWLSPQJJRGFKHEIYAYINFXJEFOFAKDADZMVODFYULEETJNSJLAXQYGVDVBEFEFJDRFSUKQPWVUQEHINTJLKISFMNGQTKVCONIGISXYPSSFWAOKTYWDGOJSCQJWAFZPSHVBATZPMSUISITMGPQNEZGGPPCQUCFNJBOJVOYHGTQYCJKJZAWEACLPROGMQLZZNOIICHPIAFGCPRLPSITSKEICSOPJZOINCRVEYLNZQTCGLOWDWQVHVDKORZXRNFEQWAVVLIUCCXINLFQHVMPQPZEHYBYMHDCEDXZOGUQIRZVDEMLAYAQOZVVYXUKFXNJBLJPRDGZVGVYKHJLGKCUKXPIVJTAHGKIRTYJWEISKEQVMAGSKINUGCDCMWCTDMCVFAECENUPRLKDLRWVZJQGMTIZQLTTYVOEVTGAGBPXMABXRXTQHKXTDFSUQLNOHCSCVZDBASZNTBLKZFAGPXATDTNUFBIMDBPZBTBBMBPFCAPCFQIUOJORDBLICUVGWLFXEHZQIOWKOLMTCVOQFCIIETRHONNLZTIDAHUIWRTKCGEECTVHVDQAXIHLWUWVOFZONUXJLQUOWYSZRNGNRXNOGUACPXXDCWSPQPZCGTQDSICKWJXOGLCMGCPWAMACJSSAHSCOLSRDBTNYCLMJXOWDR"", "Username" : "test1" }'

test-unshorten:
	curl -i -X GET http://localhost:8080/unshorten/LfeOQvi
	curl -i -X GET http://localhost:8080/unshorten/WgjnSgG

## docker stuff
docker-build: 
	docker build -t url-shortener .
	docker images

docker-run:
	sudo docker run --name url-shortener --network=host -td ethandu7/url-shortener:1.0
	docker ps

docker-shell:
	docker exec -it url-shortener bash 

docker-clean:
	docker stop mongodb
	docker rm mongodb
	docker stop url-shortener
	docker rm url-shortener
	docker rmi url-shortener

docker-ps:
	 docker ps --all --format "table {{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}\t"

docker-ps-ports:
	 docker ps --all --format "table {{.Names}}\t{{.Ports}}\t"